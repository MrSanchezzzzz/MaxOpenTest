import 'package:flutter/widgets.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:maxopentest/blocs/movies_bloc.dart';
import 'package:maxopentest/utils/shared_preferences.dart';

import '../blocs/getmovies_states.dart';
import '../entities/movie.dart';

mixin FavoriteToggleMixin<T extends StatefulWidget> on State<T> {
  Future<void> toggleFavorite(BuildContext context, GetMoviesState state, Movie? movie) async {
    if (movie == null) {
      return;
    }
    if (await Preferences.isFavorite(movie: movie)) {
      Preferences.removeFromFavorites(movie: movie);
    } else {
      Preferences.addToFavorites(movie: movie);
    }
    if (state is GetMoviesLoaded) {
      context.read<FavoriteMoviesBloc>().add(GetFavoriteMovies());
    }
  }
}
