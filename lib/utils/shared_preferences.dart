import 'dart:convert';

import 'package:shared_preferences/shared_preferences.dart';

import '../entities/movie.dart';

class Preferences{
  static Future<void> addToFavorites({required Movie movie}) async {
    final prefs = await SharedPreferences.getInstance();
    List<String> favorites=prefs.getStringList('favorites')??<String>[];
    favorites.add(jsonEncode(movie.toJson()));
    prefs.setStringList('favorites', favorites);
  }

  static Future<void> clearAll() async {
    final prefs = await SharedPreferences.getInstance();
    prefs.remove('favorites');
  }

  static void removeFromFavorites({required Movie movie}) async{
    final prefs = await SharedPreferences.getInstance();
    List<Movie> movies=await getFavorites();
    List<String> lines=<String>[];
    for(Movie m in movies) {
      if (movie.id == m.id) {
        movies.remove(movie);
        continue;
      }
      lines.add(jsonEncode(m.toJson()));
    }
    prefs.setStringList('favorites', lines);
  }

  static Future<List<Movie>> getFavorites() async {
    final prefs = await SharedPreferences.getInstance();
    List<String> favorites=prefs.getStringList('favorites')??<String>[];
    List<Movie> movies=<Movie>[];
    for(String str in favorites){
      movies.add(Movie.fromJson(jsonDecode(str)));
    }
    return movies;
  }

  static Future<bool> isFavorite({required Movie movie}) async {
    List<Movie> movies = await getFavorites();
    for(Movie m in movies){
      if(movie.id==m.id){
        return true;
      }
    }
    return false;
  }
}