import 'package:flutter/material.dart';
import 'package:flutter_bloc/flutter_bloc.dart';
import 'package:maxopentest/screens/detail_screen.dart';
import 'package:maxopentest/widgets/movie_poster.dart';
import 'package:maxopentest/widgets/rating_indicator.dart';
import '../blocs/getmovies_states.dart';
import '../blocs/movies_bloc.dart';
import '../entities/movie.dart';
import '../utils/mixins.dart';

class MovieCardTopFive extends StatefulWidget {
  final int index;

  const MovieCardTopFive({super.key, required this.index});

  @override
  State<MovieCardTopFive> createState() => _MovieCardTopFiveState();
}

class _MovieCardTopFiveState extends State<MovieCardTopFive> with FavoriteToggleMixin {
  @override
  Widget build(BuildContext context) {
    return BlocBuilder<TopFiveMoviesBloc, GetMoviesState>(builder: (context, state) {
      const double scale = 1.75;
      final width = (MediaQuery.of(context).size.width / 2) * scale;
      final height = (MediaQuery.of(context).size.width / 3) * scale;
      Movie movie = Movie.empty();
      if (state is GetMoviesLoaded) {
        movie = state.movies[widget.index];
      }
      bool isEmpty=movie.id==0;
      return Padding(
          padding: const EdgeInsets.only(right: 16, top: 20),
          child: InkWell(
              onTap:isEmpty?null:() {
                Navigator.of(context).push(
                  MaterialPageRoute(builder: (context) => DetailScreen(movie: movie)),
                );
              },
              child: Column(
                mainAxisAlignment: MainAxisAlignment.spaceBetween,
                children: [
                  Column(
                    crossAxisAlignment: CrossAxisAlignment.start,
                    children: [
                      MoviePoster(
                        width: width,
                        height: height,
                        movie: movie,
                        onTap: state is GetMoviesLoaded?(){toggleFavorite(context,state,movie);}:(){},
                        loading: isEmpty,
                      ),
                      const SizedBox(height: 12),
                      Text(
                        movie.title,
                        style: Theme.of(context).textTheme.titleLarge,
                      ),
                      const SizedBox(height: 8),
                      RatingIndicator(rating: movie.rating,iconSize: 24,),
                    ],
                  ),
                ],
              )));
    });
  }
}
